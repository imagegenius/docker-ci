<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />

    <title>CI Results: {{ image }}</title>
    <meta name="description" content="CI Results" />
    <meta name="author" content="imagegenius" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/assets/styles.css" />
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon" />
    <script
      defer
      src="https://use.fontawesome.com/releases/v5.15.4/js/all.js"
      integrity="sha384-rOA1PnstxnOBLzCLMcre8ybwbTmemjzdNlILg8O7z1lUkLXozs4DHonlDtnE7fpc"
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <div id="app">
      <header>
        <h1>Image<span>Genius</span></h1>
      </header>
      <div id="results">
        <h1>Test Results <strong>{{ image }}:{{ meta_tag }}</strong></h1>
        <h2>
          Cumulative:
          <span class="report-status-{{ report_status.lower() }}"
            >{{ report_status }}</span
          >
        </h2>
        <main>
          {% for tag in report_containers %}
          <section>
            <div class="section-header">
              <h2 class="section-header-h2">{{ image }}:{{ tag }}</h2>
            </div>
            {% if screenshot == 'true' %}
            <a href="{{ tag }}.png">
              <img
                src="{{ tag }}.png"
                alt="{{ tag }}"
                width="600"
                height="auto"
                onerror="this.onerror=null; this.src='/assets/404.jpg'; this.parentElement.setAttribute('href','/assets/404.jpg')"
              />
            </a>
            {% else %}
            <div class="tag-image">
              <span>WEB_SCREENSHOT ENV Disabled</span
              ><i class="fas fa-file-image"></i>
            </div>
            {% endif %}
            <h3 class="build-version">
              Build Version: {{ report_containers[tag]["build_version"] }}
            </h3>
            <details>
              <summary class="summary">Container Logs</summary>
              <div class="summary-container">
                <pre><code>{{ report_containers[tag]["logs"] }}</code>
          </pre>
              </div>
            </details>
            <details>
              <summary class="summary">Package info</summary>
              <div class="summary-container">
                <pre><code>{{ report_containers[tag]["sysinfo"] }}</code>
          </pre>
              </div>
            </details>
            {% if report_containers[tag]["has_warnings"]%}
            <details open>
              <summary class="warning-summary">Warnings</summary>
              {% for warning in report_containers[tag]["warnings"] %} {% if
              report_containers[tag]["warnings"][warning] %}
              <div class="warning-notice">
                <code class="warning-note"
                  ><i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                  {{ report_containers[tag]["warnings"][warning] }}</code
                >
              </div>
              {% endif %} {% endfor %}
            </details>
            {% endif %}
            <div class="table-container">
              <table class="styled-table">
                <thead>
                  <tr class="active-row">
                    <th>Test</th>
                    <th>Result</th>
                    <th>Message</th>
                  </tr>
                </thead>
                <tbody>
                  {% for test in report_containers[tag]["test_results"] %}
                  <tr>
                    <td>{{ test }}</td>
                    {% if report_containers[tag]["test_results"][test]['status']
                    == 'PASS' %}
                    <td class="result-cell">
                      {{ report_containers[tag]["test_results"][test]['status']
                      }} <i class="fas fa-check-circle"></i>
                    </td>
                    {% else %}
                    <td class="result-cell">
                      {{ report_containers[tag]["test_results"][test]['status']
                      }} <i class="fas fa-exclamation-circle"></i>
                    </td>
                    {% endif %}
                    <td>
                      {{ report_containers[tag]["test_results"][test]["message"]
                      }}
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </section>
          {% endfor %}
        </main>
      </div>
      <section class="debug-section">
        <h3><a href="ci.log">Python logs</a></h3>
        <details>
          <summary>Expand</summary>
          <pre id="logs"></pre>
        </details>
      </section>
    </div>
    <script type="text/javascript" charset="utf-8">
      fetch("ci.log")
        .then((response) => response.text())
        .then((logs) => {
          document.getElementById("logs").innerText = logs;
        });
    </script>
  </body>
</html>
