<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />

	<title>CI Results: {{ image }}</title>
	<meta name="description" content="CI Results" />
	<meta name="author" content="imagegenius" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap" rel="stylesheet" />
	<link rel="stylesheet" href="/assets/styles.css" />
	<link rel="icon" href="/assets/favicon.ico" type="image/x-icon" />
	<script defer src="https://use.fontawesome.com/releases/v5.15.4/js/all.js"
		integrity="sha384-rOA1PnstxnOBLzCLMcre8ybwbTmemjzdNlILg8O7z1lUkLXozs4DHonlDtnE7fpc"
		crossorigin="anonymous"></script>
</head>

<body>
	<div id="app">
		<header>
			<h1>ImageGenius</h1>
		</header>
		<div id="results">
			<h1><strong>Test Results:</strong> {{ image }}:{{ meta_tag }}</h1>
			<h2>Cumulative: <span class="report-status-{{ report_status.lower() }}">{{ report_status }}</span></h2>
			<main>
				{% for tag in report_containers %}
				<section>
					<div class="section-header">
						{% if report_containers[tag]["test_success"] %}
						<h3 class="section-header-status"><span class="report-status-pass">PASS</span></h3>
						{% else %}
						<h3 class="section-header-status"><span class="report-status-fail">FAIL</span></h3>
						{% endif %}
						<h2 class="section-header-h2"> {{ image }}:{{ tag }} </h2>
					</div>
					{% if screenshot == 'true' %}
					<a href="../{{ meta_tag }}/{{ tag }}.jpg">
						<img src="../{{ meta_tag }}/{{ tag }}.jpg" alt="{{ tag }}" width="600" height="auto"
							onerror="this.onerror=null; this.src='/assets/404.jpg'; this.parentElement.setAttribute('href','/assets/404.jpg')" />
					</a>
					{% endif %}
					<h3 class="build-version">Build Info: {{ report_containers[tag]["build_version"] }}</h3>
					<summary class="summary">
						<a href="../{{ meta_tag }}/{{ tag }}.log.html" target="_blank">View Container Logs</a>
					</summary>
					<summary class="summary">
						<a href="../{{ meta_tag }}/{{ tag }}.sbom.html" target="_blank">View SBOM output</a>
					</summary>
					{% if report_containers[tag]["has_warnings"]%}
					<details open>
						<summary class="warning-summary">Warnings</summary>
						{% for warning in report_containers[tag]["warnings"] %}
						{% if report_containers[tag]["warnings"][warning] %}
						<div class="warning-notice">
							<code
								class="warning-note"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> {{ report_containers[tag]["warnings"][warning] }}</code>
						</div>
						{% endif %}
						{% endfor %}
					</details>
					{% endif %}
					<div class="table-container">
						<table class="styled-table">
							<thead>
								<tr class="active-row">
									<th>Test</th>
									<th>Result</th>
									<th>Message</th>
								</tr>
							</thead>
							<tbody>
								{% for test in report_containers[tag]["test_results"] %}
								<tr>
									<td>{{ test }}</td>
									{% if report_containers[tag]["test_results"][test]['status'] == 'PASS' %}
									<td class="result-cell">{{ report_containers[tag]["test_results"][test]['status'] }}
										<i class="fas fa-check-circle"></i>
									</td>
									{% else %}
									<td class="result-cell">{{ report_containers[tag]["test_results"][test]['status'] }}
										<i class="fas fa-exclamation-circle"></i>
									</td>
									{% endif %}
									<td>{{ report_containers[tag]["test_results"][test]["message"] }}</td>
								</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</section>
				{% endfor %}
			</main>
		</div>
		<section class="debug-section">
			<summary class="summary">
				<a href="../{{ meta_tag }}/python.log.html" target="_blank">View Python Logs</a>
			</summary>
			<details>
				<summary>Expand</summary>
				<pre id="logs"></pre>
			</details>
		</section>
	</div>
	<script type="text/javascript" charset="utf-8">
		fetch("../{{ meta_tag }}/ci.log")
			.then((response) => response.text())
			.then((logs) => {
				document.getElementById("logs").innerText = logs;
			});
	</script>
</body>

</html>
